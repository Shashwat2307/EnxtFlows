<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="MyAIKart – Browse AI products and services in this category." />
    <title>Category – MyAIKart</title>
    <link rel="stylesheet" href="../css/style.css" />
</head>

<body>

    <div id="header"></div>
    <div id="categoryHeader"></div>

    <div class="ef-filter-bar">
        <div class="ef-container">
            <span class="ef-results-count" id="resultsCount"></span>
            <select class="ef-sort-select" id="sortSelect">
                <option value="featured">Sort by: Featured</option>
                <option value="rating-desc">Avg. Customer Rating</option>
                <option value="reviews-desc">Most Reviews</option>
                <option value="name-asc">Name: A to Z</option>
                <option value="name-desc">Name: Z to A</option>
            </select>
        </div>
    </div>

    <div class="ef-container">
        <div class="ef-breadcrumb" id="breadcrumb"></div>
        <section class="ef-section">
            <div id="productsGrid" class="ef-products-grid"></div>
        </section>
    </div>

    <div id="footer"></div>

    <script src="../js/data.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Render layout
        document.getElementById('header').innerHTML = renderHeader('../');
        document.getElementById('footer').innerHTML = renderFooter('../');
        setupSearch('../');

        // Get category from URL
        const params = new URLSearchParams(window.location.search);
        const categoryId = params.get('id');
        const category = getCategoryById(categoryId);

        if (category) {
            document.title = `${category.name} – MyAIKart`;

            // Category header
            document.getElementById('categoryHeader').innerHTML = `
        <div class="ef-category-header">
          <div class="ef-category-header-inner">
            <div class="ef-category-header-icon">${category.icon}</div>
            <div>
              <h1>${category.name}</h1>
              <p>Explore AI solutions designed for ${category.name.toLowerCase()}</p>
            </div>
          </div>
        </div>
      `;

            // Breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
        <a href="../index.html">MyAIKart</a>
        <span>›</span>
        <strong>${category.name}</strong>
      `;

            let products = getProductsByCategory(categoryId);
            document.getElementById('resultsCount').textContent = `${products.length} result${products.length !== 1 ? 's' : ''}`;

            function renderProducts(list) {
                const grid = document.getElementById('productsGrid');
                grid.innerHTML = list.map(p => renderProductCard(p)).join('');
                // Fix relative links for subpage
                grid.querySelectorAll('.ef-product-card').forEach(card => {
                    card.href = card.href.replace('pages/', '');
                });
            }

            renderProducts(products);

            // Sort
            document.getElementById('sortSelect').addEventListener('change', function () {
                let sorted = [...products];
                switch (this.value) {
                    case 'rating-desc': sorted.sort((a, b) => b.rating - a.rating); break;
                    case 'reviews-desc': sorted.sort((a, b) => b.reviews - a.reviews); break;
                    case 'name-asc': sorted.sort((a, b) => a.name.localeCompare(b.name)); break;
                    case 'name-desc': sorted.sort((a, b) => b.name.localeCompare(a.name)); break;
                }
                renderProducts(sorted);
            });

            highlightSubnav();
        } else {
            document.getElementById('categoryHeader').innerHTML = `
        <div class="ef-category-header">
          <div class="ef-category-header-inner">
            <h1>Category Not Found</h1>
          </div>
        </div>
      `;
        }

        // Fix subnav links for subpages
        document.querySelectorAll('.ef-subnav-link').forEach(link => {
            if (link.href.includes('pages/category.html') && !link.href.includes('../')) {
                link.href = link.href.replace('pages/category.html', 'category.html');
            }
        });
    </script>
</body>

</html>